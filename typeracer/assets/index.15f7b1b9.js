import{j as J,a as q,F as U,D as Q,l as u,p as W,y as w,b as V,C as X,c as Y,s as Z,K as _,S as ee}from"./vendor.6c86f508.js";const te=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const e of n.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&l(e)}).observe(document,{childList:!0,subtree:!0});function a(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(t){if(t.ep)return;t.ep=!0;const n=a(t);fetch(t.href,n)}};te();const s=J,y=q,T=U,z=Q({}),j=()=>V(z),K=(r,o)=>{switch(o){case"increment":return r+1;case"decrement":return r-1;case"reset":return 0;default:throw new Error("Unexpected action")}},$=(r,o)=>r+o,ne=({children:r,encKey:o})=>{const[a,l]=u(0),[t,n]=W(K,0),[e,h]=W(K,0),[i,f]=W($,0),[m,N]=W($,0),[C,v]=W(K,0),[G,I]=u(!1),[E,M]=u([]),A=c=>M([...E,...c]),[k,P]=u(0),[S,g]=u(0);w(()=>{if(m>0&&e>0){const c=(2*m-C)/m,p=t/e,d=c*p*100;P(d),g(C/5*2*Math.min(d,1))}else P(0),g(0)},[e]);const L=()=>{var d;let c=X.AES.encrypt(JSON.stringify({startTime:a,wordsCount:t,charCount:i,expectedWordsCount:e,expectedCharCount:m,strokeCount:C,inputs:E,accuracy:k}),o).toString(),p=Y.gzip(c);(d=window==null?void 0:window.top)==null||d.postMessage({score:Math.round(S*100),d:p},"*")};return s(z.Provider,{value:{startTime:a,wordsCount:t,charCount:i,expectedCharCount:m,strokeCount:C,gameStopped:G,inputs:E,wpm:S,accuracy:k,expectedWordsCount:e,mutateWordsCount:n,mutateCharCount:f,mutateExpectedCount:N,mutateStrokeCount:v,mutateExpectedWordsCount:h,stopGame:()=>I(!0),startGame:()=>l(Date.now()/1e3),appendInputs:A,uploadGameplay:L},children:r})},re=()=>{const{wordsCount:r,charCount:o,expectedCharCount:a,strokeCount:l,wpm:t,accuracy:n}=j(),e=t/100,h=Math.round(255-(255-76)*e),i=Math.round(255-(255-198)*e),f=Math.round(255-(255-103)*e);return s(T,{children:y("span",{style:{color:`rgb(${h}, ${i}, ${f})`},children:["WPM: ",t.toFixed(2)," (",n.toFixed(2),"%)"]})})},O=({divRef:r,word:o,wordProgress:a,isProcessing:l})=>y("div",{ref:r,children:[o.split("").map((t,n)=>s("span",{className:l&&a.length>n?o[n]==a.charAt(n)?"text-success":"text-danger":"",children:t})),a.slice(o.length).split("").map(t=>s("span",{className:"text-danger",children:t})),s("span",{children:"\xA0"})]}),oe=({words:r,onProgress:o,frozen:a,removeWords:l})=>{const[t,n]=u(r[0]),[e,h]=u(""),[i,f]=u([]),[m,N]=u(0),C=14.35,v=Z(null),{startTime:G,startGame:I,mutateWordsCount:E,mutateCharCount:M,mutateExpectedWordsCount:A,mutateExpectedCount:k,mutateStrokeCount:P,appendInputs:S,gameStopped:g,uploadGameplay:L}=j();return w(()=>{var c,p,d,F,R;if(G==0&&e.length>0&&I(),e[e.length-1]==" "&&e.length!=1){e.trim()==t&&E("increment"),M(e.length),k(t.length+1),A("increment");let B=r.indexOf(t)+1;n(r[B]),h("");const D=(p=(c=v.current)==null?void 0:c.getBoundingClientRect().left)!=null?p:-1,H=(R=(F=(d=v.current)==null?void 0:d.nextElementSibling)==null?void 0:F.getBoundingClientRect().left)!=null?R:0;if(D>H){let b=0,x=v.current;for(;x;)b++,x=x.previousElementSibling;S([...i,e.trim()]),f([]),N(0),l(b)}else{f(x=>[...x,e.trim()]);let b;e.trim().length>t.length?b=e.length-1:b=t.length,N(x=>x+b+1)}}},[e]),w(()=>{g&&L()},[g]),y(T,{children:[s(_,{isDisabled:g,handleKeys:["alphabetic","backspace","space"],onKeyEvent:(c,p)=>{c=="space"&&(c=" "),c=="backspace"?h(d=>d.slice(0,d.length-1)):(P("increment"),h(d=>d+c))}}),y("div",{className:"relative w-full h-[128px]",children:[s("div",{className:"border-l-4 border-l-grey border-opacity-75 h-[2rem] absolute animate-pulse transition-all",style:{left:(e.length+m)*C+"px"}}),y("div",{className:"flex flex-row font-mono select-none flex-wrap max-h-[128px] overflow-hidden text-2xl absolute",children:[r.slice(0,i.length).map((c,p)=>s(O,{word:c,wordProgress:i[p],isProcessing:!0})),s(O,{divRef:v,word:r[i.length],wordProgress:e.trim(),isProcessing:!0}),r.slice(i.length+1,i.length+50).map((c,p)=>s(O,{word:c,wordProgress:"",isProcessing:!1}))]})]}),s("button",{onClick:()=>location.reload(),className:"bg-gray-600 text-white font-mono w-full p-2 rounded text-center cursor-pointer mt-4 "+(g?"":"hidden"),children:"Klik di sini untuk refresh dan memulai ulang."})]})},se=()=>{const[r,o]=u(30),[a,l]=u(0),{startTime:t,stopGame:n}=j();return w(()=>{t!=0&&l(setInterval(()=>{o(e=>e-1)},1e3))},[t]),w(()=>{r>0||(n(),clearInterval(a))},[r]),s("div",{className:"font-retro text-lemon",children:r})};function ce(r){let o=Math.floor(Math.random()*r.length);return r[o]}function ae(){const[r,o]=u("default-key"),[a,l]=u([]);w(()=>{var n;window.addEventListener("message",e=>{console.log("New message: "+e.data),e.data.startsWith("k:")&&(o(e.data.split("k:")[1]),console.log("Received key: "+r)),e.data=="reload"&&window.location.reload()}),(n=window==null?void 0:window.top)==null||n.postMessage("ready","*")},[]),w(()=>{async function n(){let e=await fetch("./words.txt");if(e.ok){let i=(await e.text()).split(`
`),f=[];for(let m=0;m<500;m++)f.push(ce(i));l(f)}}n()},[]);const t=n=>{console.log("Remove"),l(e=>e.slice(n,e.length))};return s("div",{className:"flex flex-col items-center justify-center min-h-screen min-w-screen bg-black-900 text-white",children:s(ne,{encKey:r,children:y("div",{className:"w-full px-8 sm:px-16 md:px-32 py-16 mx-auto",children:[y("div",{className:"flex flex-row w-full justify-between font-retro",children:[s(se,{}),s(re,{})]}),a.length>1&&s(oe,{words:a,onProgress:n=>null,frozen:!1,removeWords:t})]})})})}ee(s(ae,{}),document.getElementById("app"));
